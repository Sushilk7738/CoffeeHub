{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Maid Latte{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'testapp/css/base.css' %}">
    {% block extra_css %}{% endblock %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>

<body>

    <!-- ===================== NAVBAR ===================== -->
    <nav class="navbar">
        <div class="nav-container">

            <!-- LOGO -->
            <a href="{% url 'home' %}" class="nav-logo-box">
                <img src="{%static '/testapp/images/navbar_logo.png'%}" class="nav-logo" alt="Maid Latte Logo">
            </a>

            <!-- TOGGLE (mobile) -->
            <button class="nav-toggle" id="nav-toggle-btn">â˜°</button>

            <!-- NAV MENU (mobile only shows this) -->
            <ul class="nav-links" id="nav-links">
                <li><a href="{% url 'home' %}" class="nav-item">Home</a></li>
                <li><a href="{% url 'cafe' %}" class="nav-item">Our Coffees</a></li>
                <li><a href="{% url 'about' %}" class="nav-item">About</a></li>
                <li><a href="{% url 'order_list' %}" class="nav-item">Order History</a></li>
            </ul>

            <!-- RIGHT SIDE ACTIONS (DESKTOP ONLY) -->
            <div class="nav-actions" id="nav-actions">

                <!-- CART -->
                <a href="{% url 'cart' %}" class="cart-wrapper" id="cart-count-link">
                    <span class="cart-icon">ðŸ›’</span>
                    <span class="cart-badge" id="cart-count">0</span>
                </a>

                <!-- AUTH -->
                <a href="{% url 'login' %}" class="auth-btn login-btn">Login</a>
                <a href="{% url 'signup' %}" class="auth-btn signup-btn">Sign Up</a>

                <button class="auth-btn logout-btn" id="logout-btn" style="display:none;">Logout</button>
            </div>

        </div>
    </nav>


    <!-- ===================== CONTENT ===================== -->
    <main class="content-area">
        {% block content %}{% endblock %}
    </main>


    <!-- ===================== FOOTER ===================== -->
    <footer class="footer">

        <div class="footer-section">
            <img src="{%static '/testapp/images/navbar_logo.png'%}" class="footer-logo" alt="footer-logo">
            <h3 class="footer-brand">Maid Latte Coffee Shop</h3>
            <p class="footer-desc">Serving the best coffee in Mumbai â€¢ Since 1990</p>
        </div>

        <div class="footer-section">
            <h3 class="footer-head">Quick Links</h3>
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'cafe' %}">Our Coffees</a>
            <a href="{% url 'about' %}">About</a>
        <a href="{% url 'order_list' %}">Order History</a>
        </div>

        <div class="footer-section">
            <h3 class="footer-head">Contact Us</h3>
            <form class="footer-form">
                <input type="text" placeholder="Your Name">
                <input type="email" placeholder="Your Email">
                <textarea placeholder="Message"></textarea>
                <button type="submit">Send</button>
            </form>
        </div>

    </footer>


    <!-- ===================== LOGIC (unchanged) ===================== -->
    <script>
        function showToast(text, opts = {}) {
            const bg = opts.background || (opts.type === 'error' ? 'red' : 'black');
            Toastify({
                text: text || '',
                duration: opts.duration || 1500,
                gravity: opts.gravity || 'top',
                position: opts.position || 'right',
                style: { background: bg, borderRadius: "8px", fontWeight: "600", color: "#fff" }
            }).showToast();
        }

        function updateNavbarAuth() {
            const access = localStorage.getItem('access');
            const loginBtn = document.querySelector('.login-btn');
            const signupBtn = document.querySelector('.signup-btn');
            const logoutBtn = document.getElementById('logout-btn');

            if (access) {
                loginBtn.style.display = 'none';
                signupBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
            } else {
                loginBtn.style.display = 'inline-block';
                signupBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
            }
        }

        document.getElementById('logout-btn').addEventListener('click', function () {
            localStorage.removeItem('access');
            localStorage.removeItem('refresh');
            localStorage.removeItem('cart_count');

            const badge = document.getElementById('cart-count');
            if (badge) badge.textContent = "0";

            showToast("Logged out", { background: "black" });
            updateNavbarAuth();
            setTimeout(() => window.location.reload(), 250);
        });

        async function loadCartCount() {
            const badge = document.getElementById('cart-count');
            const access = localStorage.getItem('access');

            if (access) {
                try {
                    const resp = await fetch('/api/cart/count/', {
                        headers: { "Authorization": "Bearer " + access }
                    });
                    if (resp.ok) {
                        const data = await resp.json();
                        badge.textContent = data.cart_count ?? 0;
                        localStorage.setItem('cart_count', String(data.cart_count ?? 0));
                        return;
                    }
                } catch { }
            }

            const localCount = parseInt(localStorage.getItem('cart_count') || '0', 10);
            badge.textContent = Number.isFinite(localCount) ? localCount : 0;
        }

        updateNavbarAuth();
        loadCartCount();

        /* Mobile Toggle */
        document.getElementById("nav-toggle-btn").addEventListener("click", () => {
            document.getElementById("nav-links").classList.toggle("nav-open");
        });
    </script>

</body>
</html>
